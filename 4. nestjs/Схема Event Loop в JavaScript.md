# –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã Event Loop –≤ Node.js (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)

Call Stack (–°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤)

1. Web API / C++ Bindings (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, fs, net, http, setTimeout)
2. Microtask Queue (Promise, process.nextTick)
3. Event Loop (–¶–∏–∫–ª —Å–æ–±—ã—Ç–∏–π)
4. Callback Queue (–û—á–µ—Ä–µ–¥—å –∫–æ–ª–±—ç–∫–æ–≤)
5. Worker Threads / Thread Pool (libuv)

**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Node.js**

1. **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥** –≤ Call Stack.
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (I/O, —Ç–∞–π–º–µ—Ä—ã, —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –ë–î)** –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ libuv (C++ API).
3. **Promise –∏ process.nextTick** –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ Microtask Queue.
4. **Event Loop —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –º–∏–∫—Ä–æ–∑–∞–¥–∞—á–∏** –∏–∑ Microtask Queue.
5. **–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤ (Call Stack), Event Loop –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Ñ–∞–∑–∞–º**:
   * **Timers** (setTimeout, setInterval)
   * **Pending callbacks** (–æ—à–∏–±–∫–∏ –≤ I/O)
   * **Idle, prepare** (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ)
   * **Poll** (–æ—Å–Ω–æ–≤–Ω–∞—è —Ñ–∞–∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ I/O)
   * **Check** (setImmediate)
   * **Close callbacks** (socket.on('close'))
6. **Microtask Queue –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ñ–∞–∑—ã**.
7. **–¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è**.

**process.nextTick –≤—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ Promise**.
‚úî **setImmediate –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ I/O, –∞ setTimeout –ø–æ—Å–ª–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏**.
‚úî **I/O –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ poll-—Ñ–∞–∑–µ Event Loop**.

### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Node.js**

1. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥**
2. **process.nextTick (—Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç!)**
3. **Promise (then/catch/finally)**
4. **Timers (setTimeout, setInterval)**
5. **setImmediate (–ø–æ—Å–ª–µ poll)**
6. **I/O –∫–æ–ª–±—ç–∫–∏ (fs, net, http, –ë–î, —Å–æ–∫–µ—Ç—ã)**

#### **Worker Threads (–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ JS)**

* –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á (—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).
* –†–∞–±–æ—Ç–∞—é—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫).
* –û–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ —á–µ—Ä–µ–∑ `MessagePort`.

#### **Thread Pool (–ü—É–ª –ø–æ—Ç–æ–∫–æ–≤ –≤ libuv)**

* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö C++ API (fs, crypto, zlib, DNS).
* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 4 –ø–æ—Ç–æ–∫–∞ (`UV_THREADPOOL_SIZE` –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å).

–ó–∞–¥–∞—á–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ **–ø—É–ª–µ –ø–æ—Ç–æ–∫–æ–≤** –∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop.

**Worker Threads ‚Äì –¥–ª—è CPU-–∑–∞–≥—Ä—É–∑–∫–∏**
‚úî **Thread Pool ‚Äì –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (I/O, –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è)**

#### **–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è**


| **Feature**                         | **Worker Threads**                           | **Thread Pool (libuv)**                                   |
| ----------------------------------- | -------------------------------------------- | --------------------------------------------------------- |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ | –ì–∏–±–∫–æ–µ (—Å–æ–∑–¥–∞—ë–º –≤—Ä—É—á–Ω—É—é) | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 4 (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å) |
| –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è     | CPU-–∑–∞–¥–∞—á                               | I/O-–∑–∞–ø—Ä–æ—Å–æ–≤ (fs, crypto)                         |
| –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö       | MessagePort (JSON, Buffer)                   | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ libuv             |
| –ë–ª–æ–∫–∏—Ä—É–µ—Ç Event Loop?      | –ù–µ—Ç                                       | –ù–µ—Ç                                                    |




# –°—Ö–µ–º–∞ Event Loop –≤ JavaScript

1. Call Stack (–°—Ç–µ–∫ –≤—ã–∑–æ–≤–æ–≤)
2. Web API (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ API, —Ç–∞–π–º–µ—Ä—ã, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π)
3. Callback Queue (–û—á–µ—Ä–µ–¥—å –∫–æ–ª–±—ç–∫–æ–≤)
4. Event Loop (–¶–∏–∫–ª —Å–æ–±—ã—Ç–∏–π)
5. Microtask Queue (–û—á–µ—Ä–µ–¥—å –º–∏–∫—Ä–æ–∑–∞–¥–∞—á: Promise, process.nextTick)

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

1. **–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ (Call Stack).
2. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (setTimeout, fetch, I/O)** –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ Web API.
3. **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏** –µ—ë –∫–æ–ª–±—ç–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Callback Queue.
4. **Promise –∏ process.nextTick** –ø–æ–ø–∞–¥–∞—é—Ç –≤ Microtask Queue.
5. **Event Loop —Å–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤–µ—Å—å Call Stack**.
6. **Microtask Queue –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ Callback Queue**.
7. **–ó–∞—Ç–µ–º Event Loop –±–µ—Ä—ë—Ç –∑–∞–¥–∞—á–∏ –∏–∑ Callback Queue** –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Call Stack.
8. **–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —Ü–∏–∫–ª–∞** (—à–∞–≥ 5).

üîπ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥ ‚Üí microtasks ‚Üí –∫–æ–ª–±—ç–∫–∏ –∏–∑ Callback Queue.
