### **Pull соединений** –

это способ подключения к базе данных, при котором клиент (приложение) **сам инициирует соединение** и запрашивает данные по необходимости.

### **Когда использовать Pull-соединения?**

* Когда данные **не требуют мгновенного обновления**.
* Если API **работает по запросам клиента**.
* Если **соединение дорогое**, и важно **оптимизировать его через пул**.

Если же требуется **реактивное обновление данных**, лучше использовать **Push (WebSockets, GraphQL Subscriptions, Kafka, Redis pub/sub)**.

### **Pull vs Push в контексте соединений**


| **Pull (Обычное соединение)**                                        | **Push (Постоянное соединение)**                          |
| ------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------- |
| Клиент сам подключается и отправляет запрос     | Сервер уведомляет клиента об изменениях    |
| Соединение создаётся и закрывается по запросу | Соединение держится постоянно (WebSocket, pub/sub) |
| REST API, обычные SQL-запросы                                           | WebSockets, GraphQL Subscriptions                                             |

### **Как работает pull соединение?**

1. **Клиент устанавливает соединение** с БД (например, через `pool` в PostgreSQL).
2. **Запрашивает данные** (например, `SELECT * FROM users`).
3. **Закрывает соединение** после выполнения запроса (если нет пула соединений).

### **Пример использования пула соединений в NestJS с PostgreSQL (TypeORM)**


```
import { TypeOrmModule } from '@nestjs/typeorm';

@Module({
  imports: [
    TypeOrmModule.forRoot({
      type: 'postgres',
      host: 'localhost',
      port: 5432,
      username: 'user',
      password: 'password',
      database: 'mydb',
      synchronize: true,
      entities: [__dirname + '/../**/*.entity{.ts,.js}'],
      poolSize: 10, // Использование пула соединений
    }),
  ],
})
export class AppModule {}

```


✅ **Пул соединений** позволяет **переиспользовать** соединения, уменьшая нагрузку на БД.

### **Пример Pull-запроса в PostgreSQL с использованием `pg`**

```
import { Pool } from 'pg';

const pool = new Pool({
  user: 'user',
  host: 'localhost',
  database: 'mydb',
  password: 'password',
  port: 5432,
  max: 10, // Максимальное количество соединений в пуле
});

async function getUsers() {
  const client = await pool.connect();
  try {
    const res = await client.query('SELECT * FROM users');
    return res.rows;
  } finally {
    client.release(); // Освобождаем соединение
  }
}

```

Здесь используется **пул соединений**, что предотвращает избыточное создание и закрытие соединений.
